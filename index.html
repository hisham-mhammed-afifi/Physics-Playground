<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Physics Playground - A fun physics-based puzzle game built with Matter.js" />
    <meta name="theme-color" content="#eef" />
    <title>Physics Playground</title>

    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Main game container -->
    <main id="gameContainer">
      <!-- Controls -->
      <div id="controls" role="toolbar" aria-label="Game controls">
        <button id="resetBtn" type="button" aria-label="Reset game">Reset</button>
        <button id="soundToggleBtn" type="button" aria-label="Toggle sound">Sound: On</button>
        <span id="levelDisplay" class="stat" role="status" aria-live="polite">Level: 1</span>
        <span id="scoreDisplay" class="stat" role="status" aria-live="polite">Score: 0</span>
        <span id="triesDisplay" class="stat" role="status" aria-live="polite">Tries Left: 0</span>
        <span id="highScoreDisplay" class="stat" role="status">High Score: 0</span>
      </div>

      <!-- Game canvas -->
      <canvas
        id="game"
        width="800"
        height="600"
        aria-label="Physics playground game canvas"
        role="application"
      >
        Your browser does not support the canvas element. Please use a modern browser.
      </canvas>

      <!-- Keyboard controls help text (screen reader only) -->
      <div class="sr-only" role="region" aria-label="Keyboard controls">
        <h2>Keyboard Controls</h2>
        <ul>
          <li>Arrow keys or WASD: Aim projectile (Up/Down for angle, Left/Right for power)</li>
          <li>Space or Enter: Launch projectile</li>
          <li>P or Escape: Pause/Resume game</li>
          <li>R: Reset game</li>
          <li>M: Toggle sound</li>
        </ul>
      </div>
    </main>

    <!-- Overlay for messages -->
    <div id="overlay" role="alert" aria-live="assertive"></div>

    <!-- Matter.js physics engine with SRI -->
    <script
      src="https://cdn.jsdelivr.net/npm/matter-js@0.20.0/build/matter.min.js"
      integrity="sha256-WMXMGRz1/WEO8SWI6VgG8Kc3LvLZVEhPo7LCh6/FsNI="
      crossorigin="anonymous"
    ></script>

    <!-- Game modules -->
    <script src="config.js"></script>
    <script src="AudioManager.js"></script>
    <script src="ParticleSystem.js"></script>
    <script src="LevelManager.js"></script>
    <script src="InputHandler.js"></script>
    <script src="game.js"></script>

    <!-- Game initialization -->
    <script>
      'use strict';

      // Initialize game when DOM is ready
      (function initGame() {
        // Check for required APIs
        if (!window.Matter) {
          document.getElementById('overlay').innerHTML =
            'Error: Matter.js failed to load<br><small>Please check your connection and refresh</small>';
          document.getElementById('overlay').style.display = 'block';
          return;
        }

        // Get canvas element
        const canvas = document.getElementById('game');
        if (!canvas || !canvas.getContext) {
          document.getElementById('overlay').innerHTML =
            'Error: Canvas not supported<br><small>Please use a modern browser</small>';
          document.getElementById('overlay').style.display = 'block';
          return;
        }

        // Create and initialize game
        const game = new PhysicsPlayground(canvas);
        game.initialize().catch(error => {
          console.error('Game initialization failed:', error);
          document.getElementById('overlay').innerHTML =
            `Error: ${error.message}<br><small>Please refresh the page</small>`;
          document.getElementById('overlay').style.display = 'block';
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
          game.dispose();
        });

        // Handle visibility change (pause when tab is hidden)
        document.addEventListener('visibilitychange', () => {
          if (document.hidden && game.gameState === 'playing') {
            game.pause();
          }
        });

        // Make game accessible globally for debugging
        if (typeof window !== 'undefined') {
          window.game = game;
        }
      })();
    </script>
  </body>
</html>
